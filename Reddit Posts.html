<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DS202W Sum 3 Q2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="23007 - DS202W Sum 3 ALL_files/libs/clipboard/clipboard.min.js"></script>
<script src="23007 - DS202W Sum 3 ALL_files/libs/quarto-html/quarto.js"></script>
<script src="23007 - DS202W Sum 3 ALL_files/libs/quarto-html/popper.min.js"></script>
<script src="23007 - DS202W Sum 3 ALL_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="23007 - DS202W Sum 3 ALL_files/libs/quarto-html/anchor.min.js"></script>
<link href="23007 - DS202W Sum 3 ALL_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="23007 - DS202W Sum 3 ALL_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="23007 - DS202W Sum 3 ALL_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="23007 - DS202W Sum 3 ALL_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="23007 - DS202W Sum 3 ALL_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">DS202W Sum 3 Q2</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.1.1 ──
✔ broom        1.0.5     ✔ rsample      1.2.0
✔ dials        1.2.0     ✔ tune         1.1.2
✔ infer        1.0.5     ✔ workflows    1.1.4
✔ modeldata    1.3.0     ✔ workflowsets 1.0.1
✔ parsnip      1.2.1     ✔ yardstick    1.3.0
✔ recipes      1.0.9     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'parsnip' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tune' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'workflows' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()
• Use tidymodels_prefer() to resolve common conflicts.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'viridis' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite

Attaching package: 'viridis'

The following object is masked from 'package:scales':

    viridis_pal</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidytext' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidygraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidygraph' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidygraph'

The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'textdata' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textTinyR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'textTinyR' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix

Attaching package: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'vip' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'vip'

The following object is masked from 'package:utils':

    vi</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'quanteda' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in .recacheSubclasses(def@className, def, env): undefined subclass
"ndiMatrix" of class "replValueSp"; definition not updated</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Package version: 4.0.1
Unicode version: 15.1
ICU version: 74.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Parallel computing: 12 of 12 threads used.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>See https://quanteda.io for tutorials and examples.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'quanteda'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidygraph':

    convert</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textstats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'quanteda.textstats' was built under R version 4.3.3

Warning: undefined subclass "ndiMatrix" of class "replValueSp"; definition not
updated</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'quanteda.textplots' was built under R version 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'quanteda.textplots'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidygraph':

    as.igraph</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textmodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'quanteda.textmodels' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'igraph'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:quanteda.textplots':

    as.igraph</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidygraph':

    groups</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dials':

    degree, neighbors</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:lubridate':

    %--%, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    as_data_frame, groups, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:purrr':

    compose, simplify</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    crossing</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tibble':

    as_data_frame</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    decompose, spectrum</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:base':

    union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(widyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'widyr' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggraph' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringdist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'stringdist'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
</div>
<section id="part-1---data-exploration-manipulation-feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="part-1---data-exploration-manipulation-feature-engineering">Part 1 - Data Exploration, Manipulation &amp; Feature Engineering</h2>
<p>The task requires me to create a model that predicts the ranking of a post using 2 classes: top and controversial. This requires a binary classification model which have plenty of picks from the supervised models we learnt. The steps I will take are as follows:</p>
<p>Performing a left join on posts with comments, using the post_id column. This allows me to merge both datasets without creating many more rows of data for every comment that a post received. Using another kind of join would result in a needlessly large dataset that would be computationally expensive and slow to train, fit and evaluate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read comments and posts datasets</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>comments <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"C:/Users/David Moraes/Downloads/reddit_data/reddit_comments_16_03_2023__15_03_2023.csv"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>posts <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"C:/Users/David Moraes/Downloads/reddit_data/reddit_posts_16_03_2023__15_03_2023.csv"</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge comments into posts dataset</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> posts <span class="sc">%&gt;%</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(comments, <span class="at">by =</span> <span class="st">"post_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., comments, by = "post_id"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the structure of the combined dataset</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(combined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   85410 obs. of  28 variables:
 $ ranking_type         : chr  "top" "top" "top" "top" ...
 $ post_id              : chr  "17xjfyu" "17xjfyu" "17xjfyu" "17xjfyu" ...
 $ title                : chr  "Left the office &amp;amp; found the neighbors cat in my car." "Left the office &amp;amp; found the neighbors cat in my car." "Left the office &amp;amp; found the neighbors cat in my car." "Left the office &amp;amp; found the neighbors cat in my car." ...
 $ permalink.x          : chr  "https://www.reddit.com/r/pics/comments/17xjfyu/left_the_office_found_the_neighbors_cat_in_my_car/" "https://www.reddit.com/r/pics/comments/17xjfyu/left_the_office_found_the_neighbors_cat_in_my_car/" "https://www.reddit.com/r/pics/comments/17xjfyu/left_the_office_found_the_neighbors_cat_in_my_car/" "https://www.reddit.com/r/pics/comments/17xjfyu/left_the_office_found_the_neighbors_cat_in_my_car/" ...
 $ post_hint            : chr  "image" "image" "image" "image" ...
 $ url                  : chr  "https://i.redd.it/6mmhc93lux0c1.jpg" "https://i.redd.it/6mmhc93lux0c1.jpg" "https://i.redd.it/6mmhc93lux0c1.jpg" "https://i.redd.it/6mmhc93lux0c1.jpg" ...
 $ created_utc.x        : chr  "2023-11-17 16:54:07.000000" "2023-11-17 16:54:07.000000" "2023-11-17 16:54:07.000000" "2023-11-17 16:54:07.000000" ...
 $ selftext             : chr  "" "" "" "" ...
 $ ups.x                : int  219630 219630 219630 219630 219630 219630 219630 219630 219630 219630 ...
 $ upvote_ratio         : num  0.89 0.89 0.89 0.89 0.89 0.89 0.89 0.89 0.89 0.89 ...
 $ score                : int  219630 219630 219630 219630 219630 219630 219630 219630 219630 219630 ...
 $ subreddit            : chr  "r/pics" "r/pics" "r/pics" "r/pics" ...
 $ subreddit_subscribers: int  30586189 30586189 30586189 30586189 30586189 30586189 30586189 30586189 30586189 30586189 ...
 $ over_18              : int  0 0 0 0 0 0 0 0 0 0 ...
 $ num_comments         : int  3469 3469 3469 3469 3469 3469 3469 3469 3469 3469 ...
 $ is_original_content  : int  0 0 0 0 0 0 0 0 0 0 ...
 $ author.x             : chr  "go_fight_kickass" "go_fight_kickass" "go_fight_kickass" "go_fight_kickass" ...
 $ edited.x             : num  0 0 0 0 0 0 0 0 0 0 ...
 $ domain               : chr  "i.redd.it" "i.redd.it" "i.redd.it" "i.redd.it" ...
 $ id                   : chr  "k9nqp4r" "k9no5xg" "k9npary" "k9np8p6" ...
 $ permalink.y          : chr  "/r/pics/comments/17xjfyu/left_the_office_found_the_neighbors_cat_in_my_car/k9nqp4r/" "/r/pics/comments/17xjfyu/left_the_office_found_the_neighbors_cat_in_my_car/k9no5xg/" "/r/pics/comments/17xjfyu/left_the_office_found_the_neighbors_cat_in_my_car/k9npary/" "/r/pics/comments/17xjfyu/left_the_office_found_the_neighbors_cat_in_my_car/k9np8p6/" ...
 $ author.y             : chr  "chibinoi" "JealousSnake" "Annalog" "Skivvy_Roll" ...
 $ created_utc.y        : chr  "2023-11-17 17:22:26.000000" "2023-11-17 17:05:59.000000" "2023-11-17 17:13:20.000000" "2023-11-17 17:12:58.000000" ...
 $ body                 : chr  "Haha, what an unexpected surprise! How’d that little fella get in? Slipped in when you were getting into your c"| __truncated__ "It was “Bring your neighbours cat to work day”, did nobody tell you??" "That’s the look of “who are you? Doesn’t matter, hate you anyways”" "Haha he doesn't look nearly as happy about it as you do" ...
 $ edited.y             : num  0 0 0 0 0 0 0 0 0 0 ...
 $ gilded               : num  0 0 0 0 0 0 0 0 0 0 ...
 $ ups.y                : num  1823 9518 3754 14757 16332 ...
 $ num_reports          : logi  NA NA NA NA NA NA ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#If a variable ends in .y it refers to comments and .x refers to posts. Applicable for variables like upvotes (ups)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize numerical variables</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>summarized_comments <span class="ot">&lt;-</span> comments <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(post_id) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">all_comments =</span> <span class="fu">paste</span>(body, <span class="at">collapse =</span> <span class="st">" "</span>),</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_gilded =</span> <span class="fu">mean</span>(gilded),</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_ups =</span> <span class="fu">sum</span>(ups),</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_num_reports =</span> <span class="fu">mean</span>(num_reports, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Remove NA values if any</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Count unique authors</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>author_counts <span class="ot">&lt;-</span> comments <span class="sc">%&gt;%</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(post_id) <span class="sc">%&gt;%</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">unique_authors =</span> <span class="fu">n_distinct</span>(author))</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate permalink and created_utc</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>permalink_created_utc <span class="ot">&lt;-</span> comments <span class="sc">%&gt;%</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(post_id) <span class="sc">%&gt;%</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">all_permalink =</span> <span class="fu">paste</span>(permalink, <span class="at">collapse =</span> <span class="st">"; "</span>),  <span class="co"># Using ";" as separator</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">all_created_utc =</span> <span class="fu">paste</span>(created_utc, <span class="at">collapse =</span> <span class="st">"; "</span>)  <span class="co"># Using ";" as separator</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge summarized variables into the posts data frame</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(posts, summarized_comments, <span class="at">by =</span> <span class="st">"post_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(author_counts, <span class="at">by =</span> <span class="st">"post_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(permalink_created_utc, <span class="at">by =</span> <span class="st">"post_id"</span>)</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a><span class="co">#If a variable starts with all like all_permalinks it refers to all the perma links of the comments. In the case of numerical vaues, those were just summed or averaged.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>combined_data<span class="sc">$</span>ranking_type <span class="ot">&lt;-</span> <span class="fu">factor</span>(combined_data<span class="sc">$</span>ranking_type, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"controversial"</span>, <span class="st">"top"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Some feature engineering to get the down votes for a post based of the definitions provided</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">downs =</span> ups <span class="sc">/</span> upvote_ratio)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(combined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View column names of the combined dataset</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(combined_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ranking_type"          "post_id"               "title"                
 [4] "permalink"             "post_hint"             "url"                  
 [7] "created_utc"           "selftext"              "ups"                  
[10] "upvote_ratio"          "score"                 "subreddit"            
[13] "subreddit_subscribers" "over_18"               "num_comments"         
[16] "is_original_content"   "author"                "edited"               
[19] "domain"                "all_comments"          "avg_gilded"           
[22] "total_ups"             "avg_num_reports"       "unique_authors"       
[25] "all_permalink"         "all_created_utc"       "downs"                </code></pre>
</div>
</div>
</section>
<section id="part-1---data-splitting" class="level2">
<h2 class="anchored" data-anchor-id="part-1---data-splitting">Part 1 - Data Splitting</h2>
<p>After creating my dataset which should have both top and controversial posts, I used an 80/20 split on the dataset into a training and test set respectively. I made a logistic regression model as a baseline which would serve to give me a sense of what results to expect in evaluation. Then I settled on a final tree based model (random forest) to make up for the weaknesses of logistic regression and address the challenges it could not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>dataset_split <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span> <span class="fu">initial_split</span>(<span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">training</span>(dataset_split)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(dataset_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the levels of the ranking_type variable</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(df_test<span class="sc">$</span>ranking_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "controversial" "top"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Shows top is the second event level</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-1---logistic-regression-for-classification" class="level2">
<h2 class="anchored" data-anchor-id="part-1---logistic-regression-for-classification">Part 1 - Logistic Regression for Classification</h2>
<p>I first used the logistic regression model as a baseline. It seemed suitable because its coefficients tell me the influence each feature has on the log odds outcome, making it easy to interpret. Also its robust to noise and if it performs well then that would tell me there are linear relations to be captured. And if it didn’t perform well that would tell me to use a model that can handle complex non-linear data. This was so I could get a sense of what kind of results to expect in evaluation and how to proceed from there. This model was made using the tidymodels package which enabled me to create a recipe for the work flow using the training data set. The recipe used ranking_type as the target variable and for predictors I choose post_hint, ups, upvote ratio and num_comments. Combined, these predictors reflect some information about the posts and comments and seemed appropriate as a starter model.</p>
<p>This included my data pre-processing steps. These steps involved the zero and near zero variance filters to remove variables like (over-18, is_original_content and edited) with constant values that wouldn’t give the model much useful information. Then I imputed missing values, in case there were any and used step_normalise so that all numeric predictors were on the same scale for mean and varaince. Finally, i removed highly correlated numeric variables which might cause multi-collinearity issues. This involved things like misinterpreting how important certain variables are which can lead to inaccurate model coefficients and a loss of predictive power for the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>log_reg_recipe <span class="ot">&lt;-</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">recipe</span>(ranking_type <span class="sc">~</span>  post_hint <span class="sc">+</span> ups <span class="sc">+</span> upvote_ratio, <span class="at">data =</span> df_train) <span class="sc">%&gt;%</span> </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  Handle Missing Values</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  Scale Numeric Variables</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  Remove Highly Correlated Predictors</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>(), <span class="at">threshold =</span> <span class="fl">0.9</span>) </span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(log_reg_recipe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  variable     type      role      source  
  &lt;chr&gt;        &lt;list&gt;    &lt;chr&gt;     &lt;chr&gt;   
1 post_hint    &lt;chr [3]&gt; predictor original
2 ups          &lt;chr [2]&gt; predictor original
3 upvote_ratio &lt;chr [2]&gt; predictor original
4 ranking_type &lt;chr [3]&gt; outcome   original</code></pre>
</div>
</div>
<p>After setting the recipe, I set my specification to logistic regression and defined a workflow that I then fitted the workflow to resampled training data to see how well it performs on it. This was done using the resampled function with 10 folds and the collect metrics function. On average out of 10 folds being evaluated on the training data its mean roc auc value was .0.4675385 which is poor and suggests that it struggles to find any meaningful patterns in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Baseline Logistic Regrssion</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>log_rec_specification <span class="ot">&lt;-</span>    <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>log_reg_wf <span class="ot">&lt;-</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(log_reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(log_rec_specification)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co">#The default family being binomial seems appropriate because we wnat a model that will predict binary outcomes.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Will use these folds for cross validation for both models</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(df_train, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>folds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#  10-fold cross-validation 
# A tibble: 10 × 2
   splits             id    
   &lt;list&gt;             &lt;chr&gt; 
 1 &lt;split [1440/160]&gt; Fold01
 2 &lt;split [1440/160]&gt; Fold02
 3 &lt;split [1440/160]&gt; Fold03
 4 &lt;split [1440/160]&gt; Fold04
 5 &lt;split [1440/160]&gt; Fold05
 6 &lt;split [1440/160]&gt; Fold06
 7 &lt;split [1440/160]&gt; Fold07
 8 &lt;split [1440/160]&gt; Fold08
 9 &lt;split [1440/160]&gt; Fold09
10 &lt;split [1440/160]&gt; Fold10</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> log_reg_wf <span class="sc">%&gt;%</span> <span class="fu">fit_resamples</span>(folds, <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc))</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>cv_results <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 roc_auc binary     0.476    10  0.0201 Preprocessor1_Model1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>log_reg_fit <span class="ot">&lt;-</span> log_reg_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(<span class="at">data =</span> df_train</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>                                  )</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>log_reg_model <span class="ot">&lt;-</span> log_reg_fit <span class="sc">%&gt;%</span> <span class="fu">extract_fit_parsnip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The model was then evaluated on the test data and as expected performed slightly worse with a roc auc value of 0.4332399. All the predictions made were for top posts and none for controversial. This suggested a class imbalance but this result stayed the same even after using stratified sampling in the data splitting process. I confirmed this by checking the data sets and could see that top and controversial posts were roughly even in all the data sets. This pointed to the feature selection being heavily biased to top posts. However, several combinations of numerical and categorical data (which were turned into factors) resulted in the same issue. I settled on the linear relations assumption of the model simply being inadequate to address the underlying patterns in the reddit data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#confusion matrix</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>log_reg_model <span class="sc">%&gt;%</span> </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">new_data =</span>  df_test) <span class="sc">%&gt;%</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conf_mat</span>(<span class="at">truth=</span>ranking_type, <span class="at">estimate=</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Truth
Prediction      controversial top
  controversial             0   0
  top                     206 194</code></pre>
</div>
</div>
<p>Predictions are not available for the controversial label so values like precision, recall and f measure can’t be found.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> log_reg_model <span class="sc">%&gt;%</span> </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">new_data =</span>  df_test)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>log_reg_fit_model <span class="ot">&lt;-</span> log_reg_fit <span class="sc">%&gt;%</span> <span class="fu">augment</span>(<span class="at">new_data =</span> df_test) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(<span class="at">truth =</span> ranking_type, .pred_top, <span class="at">event_level=</span><span class="st">"second"</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>log_reg_fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.430</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>log_reg_model <span class="sc">%&gt;%</span> <span class="fu">augment</span>( <span class="at">new_data =</span> df_test) <span class="sc">%&gt;%</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conf_mat</span>(<span class="at">truth=</span>ranking_type, <span class="at">estimate=</span>.pred_class)  <span class="sc">%&gt;%</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(<span class="at">estimator=</span><span class="st">"binary"</span>, <span class="at">event_level=</span><span class="st">"second"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 3
   .metric              .estimator .estimate
   &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;
 1 accuracy             binary         0.485
 2 kap                  binary         0    
 3 sens                 binary         1    
 4 spec                 binary         0    
 5 ppv                  binary         0.485
 6 npv                  binary       NaN    
 7 mcc                  binary        NA    
 8 j_index              binary         0    
 9 bal_accuracy         binary         0.5  
10 detection_prevalence binary         1    
11 precision            binary         0.485
12 recall               binary         1    
13 f_meas               binary         0.653</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Observe Coefficients</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>log_reg_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object


Call:  stats::glm(formula = ..y ~ ., family = stats::binomial, data = data)

Coefficients:
          (Intercept)  post_hinthosted:video         post_hintimage  
              0.16552               -0.17421               -0.15315  
        post_hintlink    post_hintrich:video          post_hintself  
             -0.15585               -0.81501               -0.12602  
                  ups           upvote_ratio  
              0.04935                0.03542  

Degrees of Freedom: 1599 Total (i.e. Null);  1592 Residual
Null Deviance:      2218 
Residual Deviance: 2216     AIC: 2232</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> <span class="fu">tidy</span>(log_reg_model)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  term                  estimate std.error statistic p.value
  &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept)             0.166     0.201      0.824   0.410
2 post_hinthosted:video  -0.174     0.226     -0.771   0.441
3 post_hintimage         -0.153     0.215     -0.713   0.476
4 post_hintlink          -0.156     0.226     -0.691   0.490
5 post_hintrich:video    -0.815     1.24      -0.657   0.511
6 post_hintself          -0.126     1.02      -0.123   0.902
7 ups                     0.0493    0.0513     0.963   0.336
8 upvote_ratio            0.0354    0.0522     0.678   0.498</code></pre>
</div>
</div>
<p>Logistic Regression Model Interpretation:</p>
<p>Coefficients:</p>
<p>The baseline’s probability of being top is positive evident from the positive intercept of 0.17. The coefficients tell a different story. All post_hint’s have negative influence, i.e they would influence the model to predict controversial. But their standard errors are all larger than the magnitude of the coefficient estimates. That means while the estimates are negative they could be wrong and be positive as well. This is unreliable and may be because of the high variability of the data and the models inability to capture complex relations that are non-linear.</p>
<p>Engagement metrics like ups and upvote_ratio would be expected to have a positive influence on whether a model is top or controversial and we see they are positive but small values like 0.05, 0.04 respectively. Regardless, we can see that all these variables are not making significant contributions because their p values are all very far above 0.05.</p>
<p>The results of the coefficients would suggest that many or most predictions would be controversial but this don’t seem to match with the predictions shown in the confusion matrix. As all predictions were top there must be patterns that a logistic regression model can’t pick up on.</p>
<p>AIC as well as Null and residual deviance are both well above 2000 which are very high values. These values tell us whether the models fit is good, first with just the intercept and then including predictors. Based of these deviance values it is evident that the models fit is terrible and adding the explanatory values doesn’t help at all. AIC would be useful if we were comparing this logistic regression model to similar models.</p>
</section>
<section id="part-1---random-forest-for-classification" class="level2">
<h2 class="anchored" data-anchor-id="part-1---random-forest-for-classification">Part 1 - Random Forest for Classification</h2>
<p>I first performed the random forest model without hyperparameter tuning to get a sense of what kind of results I could get using default values or simple parameter values. My random forest recipe hardly required any pre-processing steps because they are naturally robust to outliers and differences in predictors scale of values. They can also capture non linear relations and have their own ability to estimate the importance of features. My pre-processing steps were to just fill in missing values and remove troublesome features that weren’t related to ranking_type. This included all_comments because it would have been computationally expensive to end up with many columns of factors even though random forests could handle high-dim data.</p>
<p>Afters this followed the same tidy models approach of having defined the specification and workflow. This was then evaluated on the training set using 10 folds and ended up with a poor performance on roc auc of 0.4760973. It then fitted on the train data and evaluated on the test data which resulted in a roc auc of 0.9013612 with a good set of classifications as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Now using Random Forests</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>rf_recipe <span class="ot">&lt;-</span> </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">recipe</span>(ranking_type <span class="sc">~</span> ., <span class="at">data =</span> df_train) <span class="sc">%&gt;%</span> <span class="fu">step_impute_median</span>(<span class="fu">all_numeric</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span> <span class="fu">step_rm</span>(all_comments, avg_num_reports, all_permalink, all_created_utc, avg_gilded, total_ups, unique_authors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>rf_specification <span class="ot">&lt;-</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand_forest</span>(<span class="at">trees =</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>rf_wf <span class="ot">&lt;-</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(rf_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(rf_specification)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">#collect metrics on performance on each fold</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>cv_rf_results <span class="ot">&lt;-</span> rf_wf <span class="sc">%&gt;%</span> <span class="fu">fit_resamples</span>(folds, <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc))</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>cv_results <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  .metric .estimator  mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 roc_auc binary     0.476    10  0.0201 Preprocessor1_Model1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="ot">&lt;-</span> rf_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(<span class="at">data =</span> df_train</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>                                  )</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span> <span class="fu">extract_fit_parsnip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#confusion matrix</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>rf_model <span class="sc">%&gt;%</span> </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">new_data =</span>  df_test) <span class="sc">%&gt;%</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conf_mat</span>(<span class="at">truth=</span>ranking_type, <span class="at">estimate=</span>.pred_class) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Truth
Prediction      controversial top
  controversial           166  35
  top                      40 159</code></pre>
</div>
</div>
<p>Precision for label top is -&gt; 159/(159 +40) = 0.798 = 0.8</p>
<p>Recall for top is -&gt; 159/(159 +35) = 0.819 = 0.82</p>
<p>F-measure -&gt; 2*((precision*recall)/(precision + recall))</p>
<p>-&gt; 2*(0.8*0.82)/(0.8+0.82) =0.809 = 0.81</p>
<p>F measure is a good balance of recall and precision and this score even without hyper parameter tuning is already good.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> rf_model <span class="sc">%&gt;%</span> </span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">new_data =</span>  df_test)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>rf_fit_model <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span> <span class="fu">augment</span>(<span class="at">new_data =</span> df_test) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(<span class="at">truth =</span> ranking_type, .pred_top, <span class="at">event_level=</span><span class="st">"second"</span>)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>rf_fit_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.901</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>rf_model <span class="sc">%&gt;%</span> <span class="fu">augment</span>( <span class="at">new_data =</span> df_test) <span class="sc">%&gt;%</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conf_mat</span>(<span class="at">truth=</span>ranking_type, <span class="at">estimate=</span>.pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Truth
Prediction      controversial top
  controversial           166  35
  top                      40 159</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>rf_model <span class="sc">%&gt;%</span> <span class="fu">augment</span>( <span class="at">new_data =</span> df_test) <span class="sc">%&gt;%</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conf_mat</span>(<span class="at">truth=</span>ranking_type, <span class="at">estimate=</span>.pred_class)  <span class="sc">%&gt;%</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(<span class="at">estimator=</span><span class="st">"binary"</span>, <span class="at">event_level=</span><span class="st">"second"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 3
   .metric              .estimator .estimate
   &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;
 1 accuracy             binary         0.812
 2 kap                  binary         0.625
 3 sens                 binary         0.820
 4 spec                 binary         0.806
 5 ppv                  binary         0.799
 6 npv                  binary         0.826
 7 mcc                  binary         0.625
 8 j_index              binary         0.625
 9 bal_accuracy         binary         0.813
10 detection_prevalence binary         0.498
11 precision            binary         0.799
12 recall               binary         0.820
13 f_meas               binary         0.809</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the levels of 'ranking_type' </span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(predictions<span class="sc">$</span>ranking_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "controversial" "top"          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>vip<span class="sc">::</span><span class="fu">vip</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="part-1---random-forrest-with-hyper-parameter-tuning" class="level2">
<h2 class="anchored" data-anchor-id="part-1---random-forrest-with-hyper-parameter-tuning">Part 1 - Random Forrest with Hyper-parameter Tuning</h2>
<p>Then I performed hyper-parameter tuning using the grid_regular and tune_grid to find the best values for trees() and min_n(). This could have included mtry() as well but I though it may make my computer slow again. I then used select best function to find the best values for my chosen metric of accuracy. I then made some line plots to visualise which values of trees and min_n contributed to getting high accuracy and roc auc values.</p>
<p>After finding my ideal parameter valves I fitted my final model and workflow and evaluated its performance of the test set. It resulted in high accuracy and roc auc values of 0.8400000 and 0.9224302 respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>rf_tune_spec <span class="ot">&lt;-</span> </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand_forest</span>(<span class="at">min_n =</span> <span class="fu">tune</span>(),<span class="at">trees =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>rf_tune_wf <span class="ot">&lt;-</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(rf_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(rf_tune_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>tree_grid_trial <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">trees</span>(),</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">min_n</span>(),</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>rf_tune_results <span class="ot">&lt;-</span> </span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  rf_tune_wf <span class="sc">%&gt;%</span> </span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> folds,</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> tree_grid_trial</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(rf_tune_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>rf_tune_results <span class="sc">%&gt;%</span> </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 8
   trees min_n .metric  .estimator  mean     n std_err .config              
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
 1     1     2 accuracy binary     0.645    10 0.0392  Preprocessor1_Model01
 2     1     2 roc_auc  binary     0.649    10 0.0403  Preprocessor1_Model01
 3   500     2 accuracy binary     0.747    10 0.0110  Preprocessor1_Model02
 4   500     2 roc_auc  binary     0.838    10 0.00826 Preprocessor1_Model02
 5  1000     2 accuracy binary     0.738    10 0.0112  Preprocessor1_Model03
 6  1000     2 roc_auc  binary     0.834    10 0.00681 Preprocessor1_Model03
 7  1500     2 accuracy binary     0.743    10 0.00934 Preprocessor1_Model04
 8  1500     2 roc_auc  binary     0.836    10 0.00738 Preprocessor1_Model04
 9  2000     2 accuracy binary     0.74     10 0.00974 Preprocessor1_Model05
10  2000     2 roc_auc  binary     0.835    10 0.00833 Preprocessor1_Model05
# ℹ 40 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>best_rf <span class="ot">&lt;-</span> rf_tune_results <span class="sc">%&gt;%</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="at">metric =</span> <span class="st">"accuracy"</span>)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>best_rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  trees min_n .config              
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;                
1   500    40 Preprocessor1_Model22</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>rf_tune_results <span class="sc">%&gt;%</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trees =</span> <span class="fu">factor</span>(trees)) <span class="sc">%&gt;%</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(min_n, mean, <span class="at">color =</span> trees)) <span class="sc">+</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> .metric, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>()) <span class="sc">+</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">begin =</span> .<span class="dv">9</span>, <span class="at">end =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="part-1---final-workflow-and-fit" class="level2">
<h2 class="anchored" data-anchor-id="part-1---final-workflow-and-fit">Part 1 - Final Workflow and Fit</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">#From here its about finalising the workflow and fit</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>final_rf_wf <span class="ot">&lt;-</span> </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  rf_tune_wf <span class="sc">%&gt;%</span> </span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_rf)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>final_rf_wf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
2 Recipe Steps

• step_impute_median()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
Random Forest Model Specification (classification)

Main Arguments:
  trees = 500
  min_n = 40

Engine-Specific Arguments:
  importance = impurity

Computational engine: ranger </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>final_rf_fit <span class="ot">&lt;-</span> </span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  final_rf_wf <span class="sc">%&gt;%</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(dataset_split) </span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>final_rf_fit <span class="sc">%&gt;%</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric  .estimator .estimate .config             
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 accuracy binary         0.84  Preprocessor1_Model1
2 roc_auc  binary         0.922 Preprocessor1_Model1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>final_rf_model <span class="ot">&lt;-</span> final_rf_fit <span class="sc">%&gt;%</span> <span class="fu">extract_fit_parsnip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>final_rf_model <span class="sc">%&gt;%</span> </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">new_data =</span>  df_test) <span class="sc">%&gt;%</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conf_mat</span>(<span class="at">truth=</span>ranking_type, <span class="at">estimate=</span>.pred_class) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Truth
Prediction      controversial top
  controversial           172  30
  top                      34 164</code></pre>
</div>
</div>
<p>For the final random forest the precision, recall and f-measure are:</p>
<p>precision -&gt; 164/(164 + 34) = 0.82</p>
<p>recall -&gt; 164/(164 + 30) = 0.845 = 0.85</p>
<p>F-measure = 2*(0.82*0.85)/(0.82 + 0.85) = 0.834 = 0.83</p>
<p>All these final values are marginally better than the random forest without hyperparameter tuning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23007</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>final_rf_model <span class="sc">%&gt;%</span> </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">augment</span>(<span class="at">new_data =</span>  df_test) <span class="sc">%&gt;%</span></span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">conf_mat</span>(<span class="at">truth=</span>ranking_type, <span class="at">estimate=</span>.pred_class) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 13 × 3
   .metric              .estimator .estimate
   &lt;chr&gt;                &lt;chr&gt;          &lt;dbl&gt;
 1 accuracy             binary         0.84 
 2 kap                  binary         0.680
 3 sens                 binary         0.835
 4 spec                 binary         0.845
 5 ppv                  binary         0.851
 6 npv                  binary         0.828
 7 mcc                  binary         0.680
 8 j_index              binary         0.680
 9 bal_accuracy         binary         0.840
10 detection_prevalence binary         0.505
11 precision            binary         0.851
12 recall               binary         0.835
13 f_meas               binary         0.843</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize variable importance</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>vip<span class="sc">::</span><span class="fu">vip</span>(final_rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Interpretation:</p>
<p>Random forests are generally harder to interpret but because we are using it for binary classification we can rely on typical classification measures to determine how well the model is performing.</p>
<p>For all models the classifications were plotted on a confusion matrix and precision, recall and f-measure were calculated. The final random forest did have the best of all these values compared with the random forest with no hyperparameter tuning.</p>
<p>The top 3 most important features remained the same before and after tuning hyperparameters. Those were subreddit subscribers, permalink and subreddit. All these 3 are related to specific subreddits which have their own rules, norms and archetypes. Depending on the subreddit and the number of members, the engagement metrics can reflect more contentious views.</p>
</section>
<section id="part-2---exploring-manipulating-data-set" class="level2">
<h2 class="anchored" data-anchor-id="part-2---exploring-manipulating-data-set">Part 2 - Exploring &amp; Manipulating Data Set</h2>
<p>Made a dataset called unique_title_com_id_df which should only have post_id’s and titles + comments from each of the original posts. This table disregard a posts rankng type. As I intend to find the similarity between the textual data between the posts. To do this I used the cosine similarity measure.</p>
<p>It works by placing our posts title+comments in a multidimensional space as vectors. Each token is represented as a dimension and the vector occupies more dimensions as it has more terms. The angle between pairs of these vectors is found in multidimensional space and vectors which are closer together share more terms and so are more similar. The cosine value of the angle is used to scale all the values to -1 and 1 for easy comparison.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>post_comment_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"C:/Users/David Moraes/Downloads/combined_data_3.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>corp_reddit <span class="ot">&lt;-</span> quanteda<span class="sc">::</span><span class="fu">corpus</span>(post_comment_data, <span class="at">text_field=</span><span class="st">"title"</span>)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>quanteda<span class="sc">::</span><span class="fu">docnames</span>(corp_reddit) <span class="ot">&lt;-</span> post_comment_data<span class="sc">$</span>post_id</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>corp_reddit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 2,000 documents and 26 docvars.
17xjfyu.1 :
"Left the office &amp;amp; found the neighbors cat in my car."

17xjfyu.2 :
"Left the office &amp;amp; found the neighbors cat in my car."

12knt5j.1 :
"Adam Sandler and Jennifer Aniston are shocked by the size of..."

12knt5j.2 :
"Adam Sandler and Jennifer Aniston are shocked by the size of..."

126xo3m.1 :
"Hi Reddit today is grans 100th birthday and she wanted to sh..."

126xo3m.2 :
"Hi Reddit today is grans 100th birthday and she wanted to sh..."

[ reached max_ndoc ... 1,994 more documents ]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of unique subreddits</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>num_unique_subreddits <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(post_comment_data<span class="sc">$</span>subreddit))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the number of unique subreddits</span></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(num_unique_subreddits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> <span class="fu">summary</span>(corp_reddit) <span class="sc">%&gt;%</span> <span class="fu">select</span>(Text, Types, Tokens, Sentences)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> (</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(<span class="at">x=</span>Tokens))</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">fill=</span><span class="st">"#C63C4A"</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Number of Tokens"</span>,</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"Count"</span>,</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">title=</span><span class="st">"How many tokens are used to describe the titles?"</span>,</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption=</span><span class="st">"Figure 1. Distribution of</span><span class="sc">\n</span><span class="st">tokens in the corpus"</span>)</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span><span class="sc">+</span><span class="dv">2</span>, <span class="dv">2</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prettify plot a bit</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="fu">rel</span>(<span class="fl">1.5</span>)),</span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fu">rel</span>(<span class="fl">1.2</span>)),</span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="fu">rel</span>(<span class="fl">1.3</span>)),</span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x=</span><span class="fu">element_text</span>(<span class="at">margin=</span><span class="fu">margin</span>(<span class="at">t=</span><span class="dv">10</span>)),</span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y=</span><span class="fu">element_text</span>(<span class="at">margin=</span><span class="fu">margin</span>(<span class="at">r=</span><span class="dv">10</span>)),</span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="fu">rel</span>(<span class="fl">1.25</span>)))</span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a>g</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>title_data <span class="ot">&lt;-</span> post_comment_data<span class="sc">$</span>title</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with one column named 'title'</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>title_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">title =</span> title_data)</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the structure of the created data frame</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(title_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>comments_data <span class="ot">&lt;-</span>  post_comment_data<span class="sc">$</span>all_comments</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>comments_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">comments =</span> comments_data)</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(comments_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine data frames</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>title_com_df <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(title_df, comments_df)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine text from both columns into a single column</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>title_com_df <span class="ot">&lt;-</span> title_com_df <span class="sc">%&gt;%</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">title_comments =</span> <span class="fu">paste</span>(title, comments, <span class="at">sep =</span> <span class="st">" "</span>))</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only the combined text column</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>title_com_df <span class="ot">&lt;-</span> title_com_df <span class="sc">%&gt;%</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(title_comments)</span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print combined dataframe</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(title_com_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            title_comments
1 Left the office &amp;amp; found the neighbors cat in my car. Haha, what an unexpected surprise! How’d that little fella get in? Slipped in when you were getting into your car that morning? It was “Bring your neighbours cat to work day”, did nobody tell you?? That’s the look of “who are you? Doesn’t matter, hate you anyways” Haha he doesn't look nearly as happy about it as you do Butterscotch looks decidedly unthrilled about his decisions. He is doing great and safely at home.  He didn’t enjoy the adventure.  Luckily he was only in the car for 4 hours on a cool day.  Party On Butterscotch! I’m all for a great cat photo, but the sheer joy you show at finding him is truly what makes this You know he was asleep in that child seat. Cat's all: "Wait... this isn't my car..." I look the same way as the cat when I have to go to work too Be careful.  This is how I became the owner of a feral cat. He would sleep in my convertible in the passenger side rear footwell when the windows were open or the top was down.  When I moved, he decided he was moving with me, jumped in the passenger seat and gave me the “let’s go” look.  6 months later he was a well behaved inside cat that always wanted to go for car rides for the next 14 years Of course he wasn’t happy; his normal driver Toonces didn’t show up!!\n\n![gif](giphy|3o7aCYDNm1kXgSUgXm|downsized) Cat: I fucking hate you, Bob, and put that goddamn camera away. COP: Look sir, I understand your frustration. But he fits, so unfortunately he’s legally entitled to sits. Our hands are tied here. Judging by the quality of your car furniture, he's EXACTLY where he wants to be.  \n\n\nI would totally judge your neighbours on this. "It's a great day, Butterscotch!"\n"More drive, less talk, Opposable Thumbs." By the cat's expression you'd think he found you in his car instead lmao [deleted] so where did he piss? You just became an Ubpur Driver. This pic is hilarious for so many reasons! I mean why does he look so pissed off, annoyed, bothered,  and upset in the pic? As if **YOU** kidnapped him or something? 😂 curiosity definitely killed the cart. That statement still stands true in 2023. This one just happened to survive. My mother-in-law once came to visit in her minivan and after a while my neighbor knocked on my door and said there was a cat on top of her van. We thought he was joking. Sure enough, Oreo had a 6 mile ride at 50 mph on the top of a Ford Windstar. He looks like he belongs on r/oneorangebraincell When I was a kid we were packing up to move from Seattle to Spokane and I was playing with a little black and white kitten that just showed up one day and then it was time to go and my mom and uncle told me to leave it alone and get in the car. My uncle was driving his pickup with a load of stuff from the apartment and I was in the car with my mom and stepdad and brother and sister. All of a sudden my uncle started to honk to get our attention and when he was able to drive up along side of us he held something up to the window. It was the kitten. She'd crawled up into the cab of the truck after I'd left to get in my mom's car and wasn't noticed until we were already half way there. So, I got a new cat that day and no one believes to this day that I didn't put her there on purpose hoping to keep her. But it worked out that way in the end. I named her Lucky and she was with me for 12 some years. Stinkin’ Butterscotch! The look on both your faces is chef’s kiss\n\nHang this picture in the Louvre aww glad to read he was ok Reminds me of that absolutely hilarious video of the [cat appearing from the wing of an ultralite aircraft during a flight](https://www.youtube.com/watch?v=J_8mdH20qTQ)! Our cat did this one time. \n\nWe told the neighbor it was his cat now…but he returned him. \n\nMost vocal and weird cat I’ve ever had. His name was Fetch. He played fetch, either as the fetchee or the fetched (I could slide him in the linoleum floor and the dog would bring him back)…\n\nAnd the cat would sing/talk. That’s how the neighbor found him, he started singing in the backseat of his car about 5 minutes into the drive.\n\nEdit: Some people seemed to like hearing this so here’s a few more details;\nHe could almost open doors. Had very strong toes and knew how to do it, just couldn’t quite turn it far enough. \n\nHe hated the litter box so when the weather was bad and we couldn’t let him outside he’d shit in the bathtub (liked the grippy texture I guess?) \n\nWhen he got older he would knead (make biscuits, whatever you call it) our 120lb golden retriever, who loved it. Or at least never stopped him.
2 Left the office &amp;amp; found the neighbors cat in my car. Haha, what an unexpected surprise! How’d that little fella get in? Slipped in when you were getting into your car that morning? It was “Bring your neighbours cat to work day”, did nobody tell you?? That’s the look of “who are you? Doesn’t matter, hate you anyways” Haha he doesn't look nearly as happy about it as you do Butterscotch looks decidedly unthrilled about his decisions. He is doing great and safely at home.  He didn’t enjoy the adventure.  Luckily he was only in the car for 4 hours on a cool day.  Party On Butterscotch! I’m all for a great cat photo, but the sheer joy you show at finding him is truly what makes this You know he was asleep in that child seat. Cat's all: "Wait... this isn't my car..." I look the same way as the cat when I have to go to work too Be careful.  This is how I became the owner of a feral cat. He would sleep in my convertible in the passenger side rear footwell when the windows were open or the top was down.  When I moved, he decided he was moving with me, jumped in the passenger seat and gave me the “let’s go” look.  6 months later he was a well behaved inside cat that always wanted to go for car rides for the next 14 years Of course he wasn’t happy; his normal driver Toonces didn’t show up!!\n\n![gif](giphy|3o7aCYDNm1kXgSUgXm|downsized) Cat: I fucking hate you, Bob, and put that goddamn camera away. COP: Look sir, I understand your frustration. But he fits, so unfortunately he’s legally entitled to sits. Our hands are tied here. Judging by the quality of your car furniture, he's EXACTLY where he wants to be.  \n\n\nI would totally judge your neighbours on this. "It's a great day, Butterscotch!"\n"More drive, less talk, Opposable Thumbs." By the cat's expression you'd think he found you in his car instead lmao [deleted] so where did he piss? You just became an Ubpur Driver. This pic is hilarious for so many reasons! I mean why does he look so pissed off, annoyed, bothered,  and upset in the pic? As if **YOU** kidnapped him or something? 😂 curiosity definitely killed the cart. That statement still stands true in 2023. This one just happened to survive. My mother-in-law once came to visit in her minivan and after a while my neighbor knocked on my door and said there was a cat on top of her van. We thought he was joking. Sure enough, Oreo had a 6 mile ride at 50 mph on the top of a Ford Windstar. He looks like he belongs on r/oneorangebraincell When I was a kid we were packing up to move from Seattle to Spokane and I was playing with a little black and white kitten that just showed up one day and then it was time to go and my mom and uncle told me to leave it alone and get in the car. My uncle was driving his pickup with a load of stuff from the apartment and I was in the car with my mom and stepdad and brother and sister. All of a sudden my uncle started to honk to get our attention and when he was able to drive up along side of us he held something up to the window. It was the kitten. She'd crawled up into the cab of the truck after I'd left to get in my mom's car and wasn't noticed until we were already half way there. So, I got a new cat that day and no one believes to this day that I didn't put her there on purpose hoping to keep her. But it worked out that way in the end. I named her Lucky and she was with me for 12 some years. Stinkin’ Butterscotch! The look on both your faces is chef’s kiss\n\nHang this picture in the Louvre aww glad to read he was ok Reminds me of that absolutely hilarious video of the [cat appearing from the wing of an ultralite aircraft during a flight](https://www.youtube.com/watch?v=J_8mdH20qTQ)! Our cat did this one time. \n\nWe told the neighbor it was his cat now…but he returned him. \n\nMost vocal and weird cat I’ve ever had. His name was Fetch. He played fetch, either as the fetchee or the fetched (I could slide him in the linoleum floor and the dog would bring him back)…\n\nAnd the cat would sing/talk. That’s how the neighbor found him, he started singing in the backseat of his car about 5 minutes into the drive.\n\nEdit: Some people seemed to like hearing this so here’s a few more details;\nHe could almost open doors. Had very strong toes and knew how to do it, just couldn’t quite turn it far enough. \n\nHe hated the litter box so when the weather was bad and we couldn’t let him outside he’d shit in the bathtub (liked the grippy texture I guess?) \n\nWhen he got older he would knead (make biscuits, whatever you call it) our 120lb golden retriever, who loved it. Or at least never stopped him.
3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Adam Sandler and Jennifer Aniston are shocked by the size of an Australian reporter ---      \n&amp;gt;**Please read [our announcement about AI-generated content](https://www.reddit.com/r/funny/comments/12k6m37/regarding_aigenerated_content).**\n&amp;gt;\n&amp;gt;This is a friendly reminder to [read our rules](https://www.reddit.com/r/funny/wiki/rules). \n&amp;gt;\n&amp;gt;Memes, social media, hate-speech, and pornography are not allowed. \n&amp;gt;\n&amp;gt;Screenshots of Reddit are expressly forbidden, as are TikTok videos.\n&amp;gt;\n&amp;gt;**Rule-breaking posts may result in bans.**\n&amp;gt;\n&amp;gt;Please also [be wary of spam](https://www.reddit.com/r/funny/wiki/spam).\n&amp;gt;\n---\n\n\n*I am a bot, and this action was performed automatically. Please [contact the moderators of this subreddit](/message/compose/?to=/r/funny) if you have any questions or concerns.* "Oh my god! That's awful!" Exactly how you want Adam Sandler to respond when he sees you. Lol Her eyes when he stood up. [deleted] the reporter's name is Brad Blanks **Jennifer:** What are you getting in the way-- OH I SEE!\n\n🤣 They “were scared…of my brutish height.” 😂 That dude will never get lost in the background, unless he’s at the NBA All-Star game doing interviews. "Put your hat on", that's hilarious It would be great if somehow Sandler found a way to incorporate this guy in one of his movies. I just can't help but love Sandler, he's like an instant port back to being a kid again. The moment he went "AWWWW MY GGODDD!" I just smiled. “Well good for Happy Gilmo- My God!” Reminds me of that scene in Kung Fu Hustle where the guy sitting down in the crowd is challenged to a fight. See this is why I like Adam Sandler, look at his face when the dude stood up.  Just pure joy. All the upvotes for the big guy for being self aware and not wanting to block othe people's view! ok this actually made me LOL! I was scared at first that he would be a little person and Jennifer was accidently was shaming him hahaha. Adam Sandler is hilarious This guy was crouching and still was tall enough for me to think that it's just some normal dude lol Who's else is old enough and remembers the Adam Sandler cassette tapes w his comedy lol Lol Sandler got so excited immediately Gladiator but so shy Bro what happened to Vince Vaughn “.. not true, Mr Sandler stopped by for an interview just an hour ago.”\n\n“Well isn’t that just great for … OH MY GOD!” Not only was it respectful of the guy to crouch down knowing he blocks out people but that also must have been painful for the dude with being so big. Double props to him. I eat pieces of shit like you for breakfast. The level of wit required for “put your hat on and get out of here” is unimaginable. Why does this video look like it was taken in 1996? Is this the same guy that Hugh Jackman taught in elementary school? “ AWWW MY GODD THATS AWFUL!” \n\nWhat a fabulous reaction ahahaha "Put your hat on and get outta here!" so awesome
4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Adam Sandler and Jennifer Aniston are shocked by the size of an Australian reporter ---      \n&amp;gt;**Please read [our announcement about AI-generated content](https://www.reddit.com/r/funny/comments/12k6m37/regarding_aigenerated_content).**\n&amp;gt;\n&amp;gt;This is a friendly reminder to [read our rules](https://www.reddit.com/r/funny/wiki/rules). \n&amp;gt;\n&amp;gt;Memes, social media, hate-speech, and pornography are not allowed. \n&amp;gt;\n&amp;gt;Screenshots of Reddit are expressly forbidden, as are TikTok videos.\n&amp;gt;\n&amp;gt;**Rule-breaking posts may result in bans.**\n&amp;gt;\n&amp;gt;Please also [be wary of spam](https://www.reddit.com/r/funny/wiki/spam).\n&amp;gt;\n---\n\n\n*I am a bot, and this action was performed automatically. Please [contact the moderators of this subreddit](/message/compose/?to=/r/funny) if you have any questions or concerns.* "Oh my god! That's awful!" Exactly how you want Adam Sandler to respond when he sees you. Lol Her eyes when he stood up. [deleted] the reporter's name is Brad Blanks **Jennifer:** What are you getting in the way-- OH I SEE!\n\n🤣 They “were scared…of my brutish height.” 😂 That dude will never get lost in the background, unless he’s at the NBA All-Star game doing interviews. "Put your hat on", that's hilarious It would be great if somehow Sandler found a way to incorporate this guy in one of his movies. I just can't help but love Sandler, he's like an instant port back to being a kid again. The moment he went "AWWWW MY GGODDD!" I just smiled. “Well good for Happy Gilmo- My God!” Reminds me of that scene in Kung Fu Hustle where the guy sitting down in the crowd is challenged to a fight. See this is why I like Adam Sandler, look at his face when the dude stood up.  Just pure joy. All the upvotes for the big guy for being self aware and not wanting to block othe people's view! ok this actually made me LOL! I was scared at first that he would be a little person and Jennifer was accidently was shaming him hahaha. Adam Sandler is hilarious This guy was crouching and still was tall enough for me to think that it's just some normal dude lol Who's else is old enough and remembers the Adam Sandler cassette tapes w his comedy lol Lol Sandler got so excited immediately Gladiator but so shy Bro what happened to Vince Vaughn “.. not true, Mr Sandler stopped by for an interview just an hour ago.”\n\n“Well isn’t that just great for … OH MY GOD!” Not only was it respectful of the guy to crouch down knowing he blocks out people but that also must have been painful for the dude with being so big. Double props to him. I eat pieces of shit like you for breakfast. The level of wit required for “put your hat on and get out of here” is unimaginable. Why does this video look like it was taken in 1996? Is this the same guy that Hugh Jackman taught in elementary school? “ AWWW MY GODD THATS AWFUL!” \n\nWhat a fabulous reaction ahahaha "Put your hat on and get outta here!" so awesome
5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Hi Reddit today is grans 100th birthday and she wanted to show off her hairdo for such a special day Looks FANTASTIC for 100. There are 70 year old who would kill for skin that good. Her hair is fantastic. Her skin is fantastic. She is lovely!\n\nAsk her what her routine is. She can have a massive following for her guide to skin and hair alone, let alone her longevity! She looks amazing! Please tell Gran that dick nipples from the internet wishes her a happy birthday! If I was 50 years older... Born 1923.   \nProhibition ended while she was 10.   \nWOII ended while she was 22.  \nShe was 46 when men landed on the moon and 66 when the Berlin Wall fell.  \n77 when the new millennium arrived and 84 when Steve Jobs announced the iPhone.\n\nNow she is still around to witness start of the AI era. While still looking stunning.  \nGive her an extra hug. [removed] Your grandma is stunning 🌟 happy 100th, you are an inspiration to longevity! Wow she looks amazing, I love her hair style she looks she had her hair done to star in a movie or something. She also looks WAY younger than 100, wishing her a happy birthday! Absolutely slaying with that outfit! 100? No way. Gran is looking good and her hair is perfect! Gorgeous granny!! A beauty for sure... Congratulations to your grandmother, she looks fantastic today!! Happy Birthday Reddit Grandma!\n\nSeriously all of my grandparents have passed away, may I honorarily adopt your grandmother? She looks like a fun grandma to have. G.I.L.F. ! I'll be 50 next birthday and this gives me lots of hope that I'll enjoy the second half of my life, all the best to her,  her hair do looks great! It’s my birthday too! Only 60 years to young for her. ;-) I'm happy for people excited to reach this age, but the only thing I want for my 75th is to be hunted down. I like the dress! [deleted] [deleted] Donald Trumps indictment news gets 145k up votes. This post is more popular at 148k currently ! WOULD Fact check please! Misinformation on the internet is no joke! There’s no way this beautiful woman is 100. Happy Birthday, miss. Can grandma share her skin care routine? Happy birthday! She looks great!! I know we’re all thinking it; and yes, I’d do her too. Holy cow, she looks amazing! I don't believe you. She is NOT 100. She looks amazing! You can tell she was bad 🔥 30 years ago at the tender age of 70, wow! 50 years ago she was easily a 10/10. She must now be named Reddits Honorary Gran
6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Hi Reddit today is grans 100th birthday and she wanted to show off her hairdo for such a special day Looks FANTASTIC for 100. There are 70 year old who would kill for skin that good. Her hair is fantastic. Her skin is fantastic. She is lovely!\n\nAsk her what her routine is. She can have a massive following for her guide to skin and hair alone, let alone her longevity! She looks amazing! Please tell Gran that dick nipples from the internet wishes her a happy birthday! If I was 50 years older... Born 1923.   \nProhibition ended while she was 10.   \nWOII ended while she was 22.  \nShe was 46 when men landed on the moon and 66 when the Berlin Wall fell.  \n77 when the new millennium arrived and 84 when Steve Jobs announced the iPhone.\n\nNow she is still around to witness start of the AI era. While still looking stunning.  \nGive her an extra hug. [removed] Your grandma is stunning 🌟 happy 100th, you are an inspiration to longevity! Wow she looks amazing, I love her hair style she looks she had her hair done to star in a movie or something. She also looks WAY younger than 100, wishing her a happy birthday! Absolutely slaying with that outfit! 100? No way. Gran is looking good and her hair is perfect! Gorgeous granny!! A beauty for sure... Congratulations to your grandmother, she looks fantastic today!! Happy Birthday Reddit Grandma!\n\nSeriously all of my grandparents have passed away, may I honorarily adopt your grandmother? She looks like a fun grandma to have. G.I.L.F. ! I'll be 50 next birthday and this gives me lots of hope that I'll enjoy the second half of my life, all the best to her,  her hair do looks great! It’s my birthday too! Only 60 years to young for her. ;-) I'm happy for people excited to reach this age, but the only thing I want for my 75th is to be hunted down. I like the dress! [deleted] [deleted] Donald Trumps indictment news gets 145k up votes. This post is more popular at 148k currently ! WOULD Fact check please! Misinformation on the internet is no joke! There’s no way this beautiful woman is 100. Happy Birthday, miss. Can grandma share her skin care routine? Happy birthday! She looks great!! I know we’re all thinking it; and yes, I’d do her too. Holy cow, she looks amazing! I don't believe you. She is NOT 100. She looks amazing! You can tell she was bad 🔥 30 years ago at the tender age of 70, wow! 50 years ago she was easily a 10/10. She must now be named Reddits Honorary Gran</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding post_id column as well in case I need it</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>post_id_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">post_id =</span> post_comment_data<span class="sc">$</span>post_id)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>title_com_id_df <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(title_com_df, post_id_df)</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="co">#And remove duplicate values</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>unique_title_com_id_df <span class="ot">&lt;-</span> title_com_id_df <span class="sc">%&gt;%</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">title_comments =</span> <span class="fu">str_replace_all</span>(title_comments, <span class="st">"[[:punct:]]"</span>, <span class="st">""</span>))</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(unique_title_com_id_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-2---similarity-measure-function" class="level2">
<h2 class="anchored" data-anchor-id="part-2---similarity-measure-function">Part 2 - Similarity Measure &amp; Function</h2>
<p>I defined a cosine similarity function using the following function:</p>
<p> = = </p>
<p>It works by taking the text data of a pair of posts and tokenising them so that they are in discrete units which are easier to perform analysis on. Some pre-processing steps were applied to remove punctuation and make letters lowercase so that the text is consistent. All the tokens are collected to give us a bag of words representation of all the tokens across all the posts. This way the frequency of words can be summed and applied to the cosine similarity function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate cosine similarity between two vectors</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>cosine_similarity <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  dot_product <span class="ot">&lt;-</span> <span class="fu">sum</span>(x <span class="sc">*</span> y)</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  magnitude_x <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  magnitude_y <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(y<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  similarity <span class="ot">&lt;-</span> dot_product <span class="sc">/</span> (magnitude_x <span class="sc">*</span> magnitude_y)</span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(similarity)</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate cosine similarity between two posts</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>calculate_post_similarity <span class="ot">&lt;-</span> <span class="cf">function</span>(post_id1, post_id2, data) {</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract text data for the two posts</span></span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>  text1 <span class="ot">&lt;-</span> data<span class="sc">$</span>text[data<span class="sc">$</span>post_id <span class="sc">==</span> post_id1]</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>  text2 <span class="ot">&lt;-</span> data<span class="sc">$</span>text[data<span class="sc">$</span>post_id <span class="sc">==</span> post_id2]</span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if both texts are available</span></span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(text1) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">||</span> <span class="fu">length</span>(text2) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)  <span class="co"># Return NA if any text is missing</span></span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tokenize and preprocess the texts</span></span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>  tokens1 <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(text1, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>)))</span>
<span id="cb141-25"><a href="#cb141-25" aria-hidden="true" tabindex="-1"></a>  tokens2 <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(text2, <span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>)))</span>
<span id="cb141-26"><a href="#cb141-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-27"><a href="#cb141-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a vocabulary</span></span>
<span id="cb141-28"><a href="#cb141-28" aria-hidden="true" tabindex="-1"></a>  vocabulary <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(tokens1, tokens2))</span>
<span id="cb141-29"><a href="#cb141-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-30"><a href="#cb141-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create term frequency vectors for each text</span></span>
<span id="cb141-31"><a href="#cb141-31" aria-hidden="true" tabindex="-1"></a>  tf1 <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">factor</span>(tokens1, <span class="at">levels =</span> vocabulary))</span>
<span id="cb141-32"><a href="#cb141-32" aria-hidden="true" tabindex="-1"></a>  tf2 <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">factor</span>(tokens2, <span class="at">levels =</span> vocabulary))</span>
<span id="cb141-33"><a href="#cb141-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-34"><a href="#cb141-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute cosine similarity</span></span>
<span id="cb141-35"><a href="#cb141-35" aria-hidden="true" tabindex="-1"></a>  similarity <span class="ot">&lt;-</span> <span class="fu">cosine_similarity</span>(tf1, tf2)</span>
<span id="cb141-36"><a href="#cb141-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb141-37"><a href="#cb141-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(similarity)</span>
<span id="cb141-38"><a href="#cb141-38" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>2 examples were laid out. 1 allows us to check for the similarity between any 2 specific post_id’s and the other allows us to see the similarity for a large number of posts and have their values plotted on a heatmap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing similarity function on specific pair of posts</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>adj_unique_title_com_id_df <span class="ot">&lt;-</span> unique_title_com_id_df <span class="sc">%&gt;%</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">text =</span> title_comments)</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>similarity <span class="ot">&lt;-</span> <span class="fu">calculate_post_similarity</span>(<span class="st">"13tdgjo"</span>, <span class="st">"11wta7a"</span>, adj_unique_title_com_id_df)</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Cosine similarity between the posts:"</span>, similarity))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Cosine similarity between the posts: 0.71281642933254"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample a smaller subset of the original data frame</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">8</span>  <span class="co"># Adjust the sample size as needed</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>sampled_df <span class="ot">&lt;-</span> adj_unique_title_com_id_df <span class="sc">%&gt;%</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(sample_size)</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty matrix to store similarities</span></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(sampled_df)</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>similarity_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> n)</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(similarity_matrix) <span class="ot">&lt;-</span> sampled_df<span class="sc">$</span>post_id</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(similarity_matrix) <span class="ot">&lt;-</span> sampled_df<span class="sc">$</span>post_id</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through all pairs of post IDs</span></span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate similarity for each pair</span></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a>    similarity_matrix[i, j] <span class="ot">&lt;-</span> <span class="fu">calculate_post_similarity</span>(sampled_df<span class="sc">$</span>post_id[i],</span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>                                                          sampled_df<span class="sc">$</span>post_id[j],</span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a>                                                          sampled_df)</span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb144-21"><a href="#cb144-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-22"><a href="#cb144-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the matrix to a data frame for easier manipulation</span></span>
<span id="cb144-23"><a href="#cb144-23" aria-hidden="true" tabindex="-1"></a>similarity_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(similarity_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>similarity_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          146pf5h   13sghrz   17vflm8   177ax2y   130kndv   1ad7tva   13cyeuf
146pf5h 1.0000000 0.7024443 0.8210813 0.8231722 0.7117179 0.8141242 0.7563057
13sghrz 0.7024443 1.0000000 0.6415236 0.6868016 0.5989624 0.7223857 0.6545395
17vflm8 0.8210813 0.6415236 1.0000000 0.7932268 0.6439764 0.7490931 0.7744742
177ax2y 0.8231722 0.6868016 0.7932268 1.0000000 0.7130086 0.8198953 0.7504002
130kndv 0.7117179 0.5989624 0.6439764 0.7130086 1.0000000 0.7321758 0.6256892
1ad7tva 0.8141242 0.7223857 0.7490931 0.8198953 0.7321758 1.0000000 0.7553375
13cyeuf 0.7563057 0.6545395 0.7744742 0.7504002 0.6256892 0.7553375 1.0000000
122taw7 0.6721840 0.5607837 0.6624177 0.6869606 0.6563483 0.7332585 0.5947013
          122taw7
146pf5h 0.6721840
13sghrz 0.5607837
17vflm8 0.6624177
177ax2y 0.6869606
130kndv 0.6563483
1ad7tva 0.7332585
13cyeuf 0.5947013
122taw7 1.0000000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the similarity data frame to a numeric matrix</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>similarity_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(similarity_df)</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot heatmap with Viridis color palette</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap</span>(similarity_matrix, </span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">Rowv =</span> <span class="cn">NA</span>, <span class="at">Colv =</span> <span class="cn">NA</span>,</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="fu">viridis</span>(<span class="dv">256</span>),         <span class="co"># Viridis color palette</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">scale =</span> <span class="st">"column"</span>,           <span class="co"># Scale by column</span></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">margins =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>),         <span class="co"># Set margins</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Similarity Matrix Heatmap"</span>,  <span class="co"># Title</span></span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">""</span>,          <span class="co"># X-axis label</span></span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Post IDs"</span>,          <span class="co"># Y-axis label</span></span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.main =</span> <span class="fl">1.5</span>,             <span class="co"># Title font size</span></span>
<span id="cb147-14"><a href="#cb147-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.axis =</span> <span class="fl">0.8</span>,             <span class="co"># Axis font size</span></span>
<span id="cb147-15"><a href="#cb147-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.lab =</span> <span class="fl">0.8</span>)              <span class="co"># Label font size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Some improvements for this graph could include having bi-grams represent each post_id as a shortened topic title. Also have a scale of the values in the plot would make it easier to know whats relatively high and low. For now I can say that looking at the similarity dataframe earlier. Values in the 70’s seem to be high in similarity, 60’s seems to be most common and 50’s seems to indicate low similarity. Actually, since these values are all between 0-1 that would suggest they are all quiet similar. But again that doesn’t account for the order of words of the semantic meaning of them.</p>
<p>Cosine similarity is scale invariant so isn’t negatively impacted by vectors having different magnitude. For similar topics from similar sources it may appropriately determine the similarity of posts but it ignore the order of words which means it doesn’t consider the semantic meaning of posts. So while posts may be similar in terms of word frequency they may not be similar in sentiment.</p>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
</section>
<section id="part-2---bi-gram-correlations" class="level2">
<h2 class="anchored" data-anchor-id="part-2---bi-gram-correlations">Part 2 - Bi-gram Correlations</h2>
<p>The cosine similarity model is what I am locking in but as a side exploration I wanted to see if there was any pattern to the bigram or trigrams of all the posts. Also wanted to check if there was any correlation between the words used in all the posts. While I couldn’t flesh this out enough to be a second approach I left it in a little side exploration.</p>
<p>I also wanted to try and find the similarity between trigrams for each post using word correlations. But the correlation values seemed mostly low for a lot of them. Also as a note while the variables names are called bigram, they refere to trigram’s currently because I changed n = 3. This could simply be changed back to 2 or any other number of tokens.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>reddit_bigrams <span class="ot">&lt;-</span> unique_title_com_id_df <span class="sc">%&gt;%</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(bigram, title_comments, <span class="at">token =</span> <span class="st">"ngrams"</span>, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bigram))</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(reddit_bigrams)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>reddit_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>( bigram, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       bigram   n
1  one of the 412
2    a lot of 366
3 this is the 313
4 if you have 283
5      i am a 269
6   this is a 258</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>bigrams_reddit_separated <span class="ot">&lt;-</span> reddit_bigrams <span class="sc">%&gt;%</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(bigram, <span class="fu">c</span>(<span class="st">"word1"</span>, <span class="st">"word2"</span>, <span class="st">"word3"</span>), <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>bigrams_reddit_filtered <span class="ot">&lt;-</span> bigrams_reddit_separated <span class="sc">%&gt;%</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word1 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word) <span class="sc">%&gt;%</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word2 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word) <span class="sc">%&gt;%</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word3 <span class="sc">%in%</span> stop_words<span class="sc">$</span>word)</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a><span class="co"># new bigram counts:</span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>bigram_reddit_counts <span class="ot">&lt;-</span> bigrams_reddit_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word1, word2, word3, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(bigram_reddit_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>bigrams_reddit_united <span class="ot">&lt;-</span> bigrams_reddit_filtered <span class="sc">%&gt;%</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(bigram, word1, word2, word3, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(bigrams_reddit_united)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>bigrams_reddit_united <span class="sc">%&gt;%</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>( bigram, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                            bigram   n
1                         allowed gt gtscreenshots 172
2                                 bans gt gtplease 172
3                                gt gtmemes social 172
4                          gt gtrulebreaking posts 172
5                             gtmemes social media 172
6 ruleshttpswwwredditcomrfunnywikirules gt gtmemes 172</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>bigrams_reddit_separated <span class="sc">%&gt;%</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word1 <span class="sc">==</span> <span class="st">"not"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word1, word2, word3, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  word1   word2      word3   n
1   not allowed         gt 173
2   not   going         to  34
3   not  affect moderation  30
4   not    sure         if  20
5   not      be       able  17
6   not      to    mention  17</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter out rare combinations, select the first 20 rows</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>bigrams_red_sep_fil <span class="ot">&lt;-</span> bigrams_reddit_separated <span class="sc">%&gt;%</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">length =</span> <span class="fu">unit</span>(.<span class="dv">15</span>, <span class="st">"inches"</span>))</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>bigrams_red_sep_fil <span class="sc">%&gt;%</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">graph_from_data_frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">"kk"</span>) <span class="sc">+</span>  <span class="co"># Kamada-Kawai layout</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">edge_alpha =</span> n), <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">arrow =</span> grid<span class="sc">::</span><span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">"closed"</span>, <span class="at">length =</span> <span class="fu">unit</span>(.<span class="dv">15</span>, <span class="st">"inches"</span>))) <span class="sc">+</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">color =</span> <span class="st">"lightblue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Decreased node size</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">repel =</span> <span class="cn">TRUE</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Use repel for label positioning</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="section-1" class="level3">
<h3 class="anchored" data-anchor-id="section-1"></h3>
<p>Trigram Correlations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Trying to get correlations</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="co"># count words co-occuring within sections</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>word_pairs <span class="ot">&lt;-</span> bigram_reddit_counts <span class="sc">%&gt;%</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairwise_count</span>(word1, word2, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(word_pairs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>word_pairs <span class="sc">%&gt;%</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item1 <span class="sc">==</span> <span class="st">"cat"</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  item1 item2     n
  &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
1 cat   dog      17
2 cat   cute     14
3 cat   lol      13
4 cat   real     13
5 cat   time     12
6 cat   2        11</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>sampled_reddit_bigram_data <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(bigram_reddit_counts, <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>word_cors <span class="ot">&lt;-</span> sampled_reddit_bigram_data <span class="sc">%&gt;%</span> <span class="fu">pairwise_cor</span>(word1, word2, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(word_cors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    item1              item2            correlation        
 Length:713180      Length:713180      Min.   :-0.0070671  
 Class :character   Class :character   1st Qu.:-0.0011710  
 Mode  :character   Mode  :character   Median :-0.0011710  
                                       Mean   :-0.0005753  
                                       3rd Qu.:-0.0011710  
                                       Max.   : 1.0000000  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(word_cors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  item1      item2  correlation
  &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt;
1 giveupvote cancer           1
2 lol        cancer           1
3 vengeance  cancer           1
4 fruit      cancer           1
5 kitt       cancer           1
6 spots      cancer           1</code></pre>
</div>
</div>
</section>
</section>
<section id="part-3---data-exploration-manipulation" class="level2">
<h2 class="anchored" data-anchor-id="part-3---data-exploration-manipulation">Part 3 - Data Exploration &amp; Manipulation</h2>
<p>Research Question:</p>
<p>How well do posts perform in various engagement metrics across different subreddits?</p>
<p>In order to do this I needed to extract numeric features from the combined text of the title and comments for each post. I did not include self text as it was mostly empty.</p>
<p>The features involved the word count, average word count, unique word count and sentiment scores. The sentiment scores were found using the vocabulary held in the AFINN package. Using an inner join between the AFINN vocabulary (each with a numeric positive/negative score assigned) and the text data of the posts I could create a summed sentiment score for each post. I had initially used the tf_idf() to assign a higher weight to important words and lower weights to common words. But these values were mostly the same for all the posts so they were removed.</p>
<p>I then performed one more left join with the text numeric data and the top_post_comment_data .(This included only the top comments because the top comments and controversial comments were mostly replicas of each other except for a couple predictors)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>AFINN <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="st">"afinn"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Text data</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="st">"Left the office amp found the neighbors cat in my car Haha what an unexpected surprise Howd that little fella get in Slipped in when you were getting into your car that morning It was Bring your neighbours cat to work day did nobody tell you Thats the look of who are you Doesnt matter hate you anyways Haha he doesnt look nearly as happy about it as you do Butterscotch looks decidedly unthrilled about his decisions He is doing great and safely at home  He didnt enjoy the adventure"</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert text to a tibble with one row</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>text_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">text =</span> text)</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Tokenize the text</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>text_df <span class="ot">&lt;-</span> text_df <span class="sc">%&gt;%</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text)</span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Match words with AFINN lexicon</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>matched_words <span class="ot">&lt;-</span> text_df <span class="sc">%&gt;%</span></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(AFINN, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(word, value)</span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the matched words and their respective sentiment scores</span></span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(matched_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  word      value
  &lt;chr&gt;     &lt;dbl&gt;
1 haha          3
2 matter        1
3 hate         -3
4 haha          3
5 happy         3
6 great         3
7 safely        1
8 enjoy         2
9 adventure     2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate sentiment score</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>sentiment_score <span class="ot">&lt;-</span> text_df <span class="sc">%&gt;%</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(AFINN, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sentiment_score =</span> <span class="fu">sum</span>(value)</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the sentiment score</span></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sentiment_score)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  sentiment_score
            &lt;dbl&gt;
1              15</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tokenize the text and calculate numeric features for each post</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>text_numeric_features <span class="ot">&lt;-</span> unique_title_com_id_df <span class="sc">%&gt;%</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">post_id =</span> <span class="fu">as.character</span>(post_id)) <span class="sc">%&gt;%</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, title_comments) <span class="sc">%&gt;%</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(post_id) <span class="sc">%&gt;%</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">word_count =</span> <span class="fu">n</span>(),</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">average_word_length =</span> <span class="fu">mean</span>(<span class="fu">nchar</span>(word)),</span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_word_count =</span> <span class="fu">n_distinct</span>(word)</span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate sentiment score for each post</span></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a>sentiment_score <span class="ot">&lt;-</span> unique_title_com_id_df <span class="sc">%&gt;%</span></span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, title_comments) <span class="sc">%&gt;%</span></span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(<span class="fu">get_sentiments</span>(<span class="st">"afinn"</span>), <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(post_id) <span class="sc">%&gt;%</span></span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sentiment_score =</span> <span class="fu">sum</span>(value)</span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb173-20"><a href="#cb173-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-21"><a href="#cb173-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Getting tf_idf</span></span>
<span id="cb173-22"><a href="#cb173-22" aria-hidden="true" tabindex="-1"></a>tf_idf <span class="ot">&lt;-</span> unique_title_com_id_df <span class="sc">%&gt;%</span></span>
<span id="cb173-23"><a href="#cb173-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(post_id, title_comments) <span class="sc">%&gt;%</span></span>
<span id="cb173-24"><a href="#cb173-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_tf_idf</span>(post_id, title_comments, n) <span class="sc">%&gt;%</span></span>
<span id="cb173-25"><a href="#cb173-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(tf_idf))</span>
<span id="cb173-26"><a href="#cb173-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-27"><a href="#cb173-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-28"><a href="#cb173-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-29"><a href="#cb173-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine numeric features and sentiment score into the same dataframe</span></span>
<span id="cb173-30"><a href="#cb173-30" aria-hidden="true" tabindex="-1"></a>text_numeric_features <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(text_numeric_features, sentiment_score, <span class="at">by =</span> <span class="st">"post_id"</span>)</span>
<span id="cb173-31"><a href="#cb173-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-32"><a href="#cb173-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined features</span></span>
<span id="cb173-33"><a href="#cb173-33" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(text_numeric_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>top_post_comment_data <span class="ot">&lt;-</span> post_comment_data  <span class="sc">%&gt;%</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ranking_type <span class="sc">==</span> <span class="st">"top"</span>)</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(top_post_comment_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform a left join based on post_id</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>combined_features <span class="ot">&lt;-</span> <span class="fu">left_join</span>(text_numeric_features, top_post_comment_data <span class="sc">%&gt;%</span> </span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">select</span>(post_id, ups, downs, unique_authors, total_ups, num_comments, subreddit_subscribers, upvote_ratio, score), </span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">by =</span> <span class="st">"post_id"</span>)</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated combined_features dataframe</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(combined_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2"></h2>
</section>
<section id="part-3---feature-engineering---pca" class="level2">
<h2 class="anchored" data-anchor-id="part-3---feature-engineering---pca">Part 3 - Feature Engineering - PCA</h2>
<p>Now before I performed K means clustering I wanted to reduce my predictors to 2 dimension as this reduces our chance for overfitting while also making the process less computationall intensive. So I would need to perform PCA to end up with just PC1 and PC2. First I create a recipe with no target variable as it is unsupervised learning and the data being our combined features. I use update role to remove post_id from the modelling step snice it only takes numeric predictors. Then I fill in missing values, remove low variance predictors and normalise predictors mean and variance before finally applying pca.</p>
<p>Then I apply our recipe to our data data and select our principal components that will be used for K means clustering. To get a sense of how much variance I am capturing with my principal components I get the eigenvalues and plot them. Looking at this the first two principal components capture about 50% of the variance in the data. Ideally I would want to capture the large majority like 80% but I stick with this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using PCA to reduce to 2 dimensions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>pca_recipe <span class="ot">&lt;-</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># unsupervised so no need for an outcome variable</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(<span class="sc">~</span>., <span class="at">data =</span> combined_features) <span class="sc">%&gt;%</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#make sure to ignore non-numeric columns (education, marital_status) and irrelevant predictors (id, year_birth) from the list of predictors</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(<span class="fu">c</span>(post_id), <span class="at">new_role =</span> <span class="st">"ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#apply knn imputation to fill missing values </span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_knn</span>(<span class="fu">all_numeric_predictors</span>(), <span class="at">neighbors =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove zero variance predictors as they don't carry any information</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize the data to avoid out-sized impact of some variables</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># apply principal component analysis</span></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_numeric_predictors</span>(), <span class="at">num_comp =</span> <span class="dv">2</span>, <span class="at">keep_original_cols=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prep</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co">#applying recipe to our features to select PC1 and PC2</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>pca_results <span class="ot">&lt;-</span> <span class="fu">bake</span>(pca_recipe, combined_features)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>pca_results <span class="sc">%&gt;%</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PC1, PC2) <span class="sc">%&gt;%</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
      PC1    PC2
    &lt;dbl&gt;  &lt;dbl&gt;
1 -1.68   -0.296
2 -0.0748 -0.643
3  0.393  -0.657
4 -2.81   -0.289
5  1.29   -0.952
6  0.428   0.163</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_results, <span class="fu">aes</span>(PC1, PC2)) <span class="sc">+</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.3</span>,<span class="at">color=</span><span class="st">"#7038d1"</span>) <span class="sc">+</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Principal Components"</span>, <span class="at">subtitle =</span> <span class="st">"2-dimensional representation of all the predictors"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-138-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>pca_fit <span class="ot">&lt;-</span> pca_recipe<span class="sc">$</span>steps[[<span class="dv">4</span>]]<span class="sc">$</span>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>eigenvalues <span class="ot">&lt;-</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  pca_fit <span class="sc">%&gt;%</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(<span class="at">matrix =</span> <span class="st">"eigenvalues"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting eigenvalues (principal components) to see each ones influence over the total variance.</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>eigenvalues <span class="sc">%&gt;%</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(PC <span class="sc">&lt;=</span> <span class="dv">23</span>) <span class="sc">%&gt;%</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC, percent)) <span class="sc">+</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()<span class="sc">+</span></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> percent), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-141-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-3" class="level2">
<h2 class="anchored" data-anchor-id="section-3"></h2>
</section>
<section id="part-3---k-means-clustering" class="level2">
<h2 class="anchored" data-anchor-id="part-3---k-means-clustering">Part 3 - K-Means Clustering</h2>
<p>To decide how many clusters I want to use I plot the K means clusters using clusters 1-9 just to see what all the options look like. I also use the elbow plot to pinpoint at which cluster the gradient decreases at a slow enough rate to form the point of an elbow. This seems to be about 5 clusters. Using pca and kclust I can apply clustering to the dataset and from there analyse these clusters.</p>
<p>We can see about 5 clusters and know I want to know how all these clusters are different in terms of their values for all the predictors. I also want to know which subreddits are in each of these clusters so I can start to identify the differences or similarities in their users behaviour.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>recipe_kmeans <span class="ot">&lt;-</span> <span class="fu">recipe</span>(<span class="sc">~</span> ., <span class="at">data =</span> combined_features) <span class="sc">%&gt;%</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_impute_knn</span>(all_numeric_predictors, <span class="at">neighbors =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>kclust <span class="ot">=</span> </span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>  pca_results  <span class="sc">%&gt;%</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(PC1, PC2) <span class="sc">%&gt;%</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(<span class="at">centers =</span> <span class="dv">5</span>) </span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(kclust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 5
     PC1    PC2  size withinss cluster
   &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;fct&gt;  
1 -4.82   0.838    66   419.   1      
2  0.659 -0.736   411   235.   2      
3  2.84  21.9       2     5.83 3      
4 -1.27  -0.270   242   322.   4      
5  1.27   0.973   276   517.   5      </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(kclust, pca_results) <span class="sc">%&gt;%</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>PC1, <span class="at">y=</span>PC2, <span class="at">color=</span>.cluster), <span class="at">alpha=</span><span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">tidy</span>(kclust), <span class="fu">aes</span>(<span class="at">x=</span>PC1, <span class="at">y=</span>PC2), <span class="at">size =</span> <span class="dv">8</span>, <span class="at">shape =</span> <span class="st">"x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-150-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot with points colored by cluster</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">augment</span>(kclust, pca_results) <span class="sc">%&gt;%</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> .cluster), <span class="at">alpha =</span> <span class="fl">0.6</span>)</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly select 10 points</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>subset_data <span class="ot">&lt;-</span> <span class="fu">augment</span>(kclust, pca_results) <span class="sc">%&gt;%</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="at">size =</span> <span class="dv">10</span>)  <span class="co"># Randomly select 10 points</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add text annotations for post_id</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>plot <span class="sc">+</span></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> subset_data, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">label =</span> post_id), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-152-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here are the plots I used to land on using 5 clusters. This process was akin to fitting the model if this was supervised learning. The K means cluster finding the x and y coordinates for the centroids to be places is the equivalent to the process of finding the predictions like in supervised learning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Multiple Cluster Plots and Elbow plot to determine suitable number of clusters</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>kclusts <span class="ot">&lt;-</span> </span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">kclust =</span> <span class="fu">map</span>(k, <span class="sc">~</span><span class="fu">kmeans</span>(<span class="fu">select</span>(pca_results, PC1, PC2), .x)),</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">tidied =</span> <span class="fu">map</span>(kclust, tidy),</span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">glanced =</span> <span class="fu">map</span>(kclust, glance),</span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">augmented =</span> <span class="fu">map</span>(kclust, augment, pca_results)</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> </span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a>  kclusts <span class="sc">%&gt;%</span></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(tidied))</span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a>assignments <span class="ot">&lt;-</span> </span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a>  kclusts <span class="sc">%&gt;%</span> </span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(augmented))</span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a>clusterings <span class="ot">&lt;-</span> </span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a>  kclusts <span class="sc">%&gt;%</span></span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(glanced))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(assignments, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> .cluster), <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> k) <span class="sc">+</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> clusters, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="st">"x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-155-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(clusterings, <span class="fu">aes</span>(k, tot.withinss)) <span class="sc">+</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">"red"</span>,<span class="at">alpha=</span><span class="fl">0.5</span>,<span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span><span class="st">"red"</span>,<span class="at">size=</span><span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_grey</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-156-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4"></h2>
</section>
<section id="part-3---observations-of-clustered-samples" class="level2">
<h2 class="anchored" data-anchor-id="part-3---observations-of-clustered-samples">Part 3 - Observations of Clustered Samples</h2>
<p>Observations from the cluster comparison plot and table showing the subreddits belonging to each cluster:</p>
<p>Cluster 4 is the smallest and only contains 2 posts which both seem to be anomalous compared to the rest of the posts characteristics. Cluster 4 boasts high total ups and word count. There could be 2 reason for this. This post may have appealed to a large audience which prompts them to engage with via comments. Or they have abnormally high likes and word count because they could have been made and boosted by bots. Upon inspecting the posts they both seem to be the former because they are story based posts which encourage others to share their own emotionally charged story.</p>
<p>Cluster 5 is the largest and appears to be the worse performing posts. The posts here, despite having comparable subscribers to the other clusters, perform the worst. They seem to have the lowest engagement and appeal as seems to be the case form having relatively lower comments, sentiment score, total ups.</p>
<p>Clusters 1 and 2 seem to be about the same size and make up more than half of the posts. In terms of positive engagement metrics it seems cluster 2 is the better half. Its often roughly double cluster 1 in important metrics like comments, sentiment score and total ups. Interestingly enough cluster 1 beats it in ups which is specifically engagement with the post. This suggests that cluster 2’s positive engagement comes from the community interacting with themselves more than the actual post.</p>
<p>Cluster 3’s number of comments was the second highest, rivalling cluster 2 but this despite this massive engagement it seems to have the largest downs and one of the largest ups and total ups. This suggests that it was highly polarising. Upon inspection this cluster tends to focus subreddits like r/funny, r/worldnews and r/gaming all of which can be controversial or polarising due to the various heated opinions that reside on these subreddits.</p>
<p>Overall the clusters could be ranked in terms of how well performing their respective posts are. In this case we have the following order:</p>
<p>Anomalously well performing - cluster 4</p>
<p>Above average - cluster 3</p>
<p>Average - cluster 1 and 2 (cluster 2 being the better half)</p>
<p>Below average - cluster 5</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order the dataframe by subreddit_subscribers in descending order and select unique subreddits with their respective subscribers</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>unique_subreddits <span class="ot">&lt;-</span> post_comment_data <span class="sc">%&gt;%</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(subreddit_subscribers)) <span class="sc">%&gt;%</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(subreddit, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subreddit, subreddit_subscribers)</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the unique subreddits and their respective subscribers</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(unique_subreddits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             subreddit subreddit_subscribers
1              r/funny              57586233
2          r/AskReddit              45470653
3             r/gaming              39960947
4                r/aww              35562042
5          r/worldnews              35553014
6      r/todayilearned              35141221
7              r/Music              33167868
8             r/movies              32446998
9            r/science              31627044
10              r/pics              30586189
11    r/Showerthoughts              30106249
12              r/news              27593656
13            r/videos              26856414
14             r/space              25087785
15             r/books              23848666
16               r/DIY              23811682
17         r/EarthPorn              23746287
18              r/food              23618154
19       r/nottheonion              23346021
20 r/mildlyinteresting              23118807
21       r/LifeProTips              22569024
22           r/gadgets              22154169
23              r/gifs              21673955
24            r/sports              20942457
25   r/dataisbeautiful              20539326
26     r/UpliftingNews              19607097
27              r/tifu              18529569
28     r/OldSchoolCool              18473614</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract cluster assignments from kclust</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>cluster_assignments <span class="ot">&lt;-</span> <span class="fu">augment</span>(kclust, pca_results) <span class="sc">%&gt;%</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.cluster, post_id)  <span class="co"># Select only .cluster and post_id columns</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine with post_id from pca_results</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>cluster_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cluster_assignments, pca_results, <span class="at">by =</span> <span class="st">"post_id"</span>)</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>cluster_assignments</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 997 × 2
   .cluster post_id
   &lt;fct&gt;    &lt;fct&gt;  
 1 4        11t0pyf
 2 2        11t7o0j
 3 2        11t9u95
 4 4        11tgzva
 5 2        11tkmir
 6 2        11tnzea
 7 4        11toxgx
 8 5        11tqcaf
 9 5        11ttyna
10 4        11u08ib
# ℹ 987 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, cluster_data contains cluster assignments specific to each post_id</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's group post_ids by cluster and count the number of post_ids in each cluster</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>post_ids_count_by_cluster <span class="ot">&lt;-</span> cluster_data <span class="sc">%&gt;%</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(.cluster)</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the count of post_ids for each cluster</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(post_ids_count_by_cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  .cluster     n
  &lt;fct&gt;    &lt;int&gt;
1 1           66
2 2          411
3 3            2
4 4          242
5 5          276</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>specific_value <span class="ot">&lt;-</span> <span class="st">"3"</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(cluster_assignments, .cluster <span class="sc">==</span> specific_value)</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>filtered_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  .cluster post_id
  &lt;fct&gt;    &lt;fct&gt;  
1 3        12erkem
2 3        12rt24x</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>specific_value <span class="ot">&lt;-</span> <span class="st">"120oesm"</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(post_comment_data, post_id <span class="sc">==</span> specific_value)</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>filtered_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     ranking_type post_id            title
139           top 120oesm Sad Samus noises
140 controversial 120oesm Sad Samus noises
                                                             permalink
139 https://www.reddit.com/r/gaming/comments/120oesm/sad_samus_noises/
140 https://www.reddit.com/r/gaming/comments/120oesm/sad_samus_noises/
    post_hint                                 url                created_utc
139     image https://i.redd.it/eurrcrnp2rpa1.jpg 2023-03-24 15:52:56.000000
140     image https://i.redd.it/eurrcrnp2rpa1.jpg 2023-03-24 15:52:56.000000
    selftext   ups upvote_ratio score subreddit subreddit_subscribers over_18
139          99180         0.75 99180  r/gaming              39960945       0
140          99174         0.75 99174  r/gaming              39960807       0
    num_comments is_original_content   author edited    domain
139         4758                   0 tyrael98      0 i.redd.it
140         4758                   0 tyrael98      0 i.redd.it
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  all_comments
139 Is Ms. PAC-MAN a joke to you? Jennifer Lawrence paved the way for Samus. Tbh, you could put up a picture of any blonde video game lady with a ponytail and convince people it's zero suit Samus from a new game This happened over a year ago. Digging through the repost folder? Yeah, it's like Siguorney Weaver thanking Jennifer Lawrence for paving the way for female action heroes. The average non-gamer has no idea Samus is female and probably thinks her name is Metroid kind of like the whole Link/Zelda thing. I haven’t read the article but I’m assuming it’s just because she’s the main female protagonist of one of the most popular current gen video games at the moment. No one said she’s the first ever woman to be the star of a video game, or that she’s a groundbreaking feminist icon. Or at least that’s how I see it. Sad Kerrigan noise,\n\nSad Lara noise, \n\nSad Jill (resident evil) noise\n\nSad Jill of the jungle noise (early 90's DOS game,) \n\nTo mention just a few Problem with Samus is that every time she steps out of the armor she's an underwear model. To be fair tho, Samus may have been unexpected but she was still a tall, leggy blonde. Later incarnations she's even smoking hot wearing a skin-tight jumpsuit which leaves little to the imagination. “I’ve had enough of your tabloid journalism”  \n- Femshep about to knock out an interviewer, MassEffect
140 Is Ms. PAC-MAN a joke to you? Jennifer Lawrence paved the way for Samus. Tbh, you could put up a picture of any blonde video game lady with a ponytail and convince people it's zero suit Samus from a new game This happened over a year ago. Digging through the repost folder? Yeah, it's like Siguorney Weaver thanking Jennifer Lawrence for paving the way for female action heroes. The average non-gamer has no idea Samus is female and probably thinks her name is Metroid kind of like the whole Link/Zelda thing. I haven’t read the article but I’m assuming it’s just because she’s the main female protagonist of one of the most popular current gen video games at the moment. No one said she’s the first ever woman to be the star of a video game, or that she’s a groundbreaking feminist icon. Or at least that’s how I see it. Sad Kerrigan noise,\n\nSad Lara noise, \n\nSad Jill (resident evil) noise\n\nSad Jill of the jungle noise (early 90's DOS game,) \n\nTo mention just a few Problem with Samus is that every time she steps out of the armor she's an underwear model. To be fair tho, Samus may have been unexpected but she was still a tall, leggy blonde. Later incarnations she's even smoking hot wearing a skin-tight jumpsuit which leaves little to the imagination. “I’ve had enough of your tabloid journalism”  \n- Femshep about to knock out an interviewer, MassEffect
    avg_gilded total_ups avg_num_reports unique_authors
139 0.09090909     36873              NA             11
140 0.09090909     36873              NA             11
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       all_permalink
139 /r/gaming/comments/120oesm/sad_samus_noises/jdildal/; /r/gaming/comments/120oesm/sad_samus_noises/jdi8dln/; /r/gaming/comments/120oesm/sad_samus_noises/jdi958b/; /r/gaming/comments/120oesm/sad_samus_noises/jdi9cav/; /r/gaming/comments/120oesm/sad_samus_noises/jdi9ka1/; /r/gaming/comments/120oesm/sad_samus_noises/jdi76gk/; /r/gaming/comments/120oesm/sad_samus_noises/jdiwr0b/; /r/gaming/comments/120oesm/sad_samus_noises/jdiaexv/; /r/gaming/comments/120oesm/sad_samus_noises/jdiagrk/; /r/gaming/comments/120oesm/sad_samus_noises/jdidmz6/; /r/gaming/comments/120oesm/sad_samus_noises/jdice08/
140 /r/gaming/comments/120oesm/sad_samus_noises/jdildal/; /r/gaming/comments/120oesm/sad_samus_noises/jdi8dln/; /r/gaming/comments/120oesm/sad_samus_noises/jdi958b/; /r/gaming/comments/120oesm/sad_samus_noises/jdi9cav/; /r/gaming/comments/120oesm/sad_samus_noises/jdi9ka1/; /r/gaming/comments/120oesm/sad_samus_noises/jdi76gk/; /r/gaming/comments/120oesm/sad_samus_noises/jdiwr0b/; /r/gaming/comments/120oesm/sad_samus_noises/jdiaexv/; /r/gaming/comments/120oesm/sad_samus_noises/jdiagrk/; /r/gaming/comments/120oesm/sad_samus_noises/jdidmz6/; /r/gaming/comments/120oesm/sad_samus_noises/jdice08/
                                                                                                                                                                                                                                                                                                       all_created_utc
139 2023-03-24 17:26:58.000000; 2023-03-24 16:05:17.000000; 2023-03-24 16:10:05.000000; 2023-03-24 16:11:20.000000; 2023-03-24 16:12:45.000000; 2023-03-24 15:57:42.000000; 2023-03-24 18:39:47.000000; 2023-03-24 16:18:06.000000; 2023-03-24 16:18:25.000000; 2023-03-24 16:38:22.000000; 2023-03-24 16:30:30.000000
140 2023-03-24 17:26:58.000000; 2023-03-24 16:05:17.000000; 2023-03-24 16:10:05.000000; 2023-03-24 16:11:20.000000; 2023-03-24 16:12:45.000000; 2023-03-24 15:57:42.000000; 2023-03-24 18:39:47.000000; 2023-03-24 16:18:06.000000; 2023-03-24 16:18:25.000000; 2023-03-24 16:38:22.000000; 2023-03-24 16:30:30.000000
     downs
139 132240
140 132232</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define custom color palette</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>custom_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#1f77b4"</span>, <span class="st">"#ff7f0e"</span>, <span class="st">"#2ca02c"</span>, <span class="st">"#d62728"</span>, <span class="st">"#9467bd"</span>)  <span class="co"># Example colors, feel free to adjust</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape the data into long format</span></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>cluster_data_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(cluster_data, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"word_count"</span>, <span class="st">"average_word_length"</span>, <span class="st">"unique_word_count"</span>, <span class="st">"sentiment_score"</span>, <span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"ups"</span>, <span class="st">"downs"</span>, <span class="st">"unique_authors"</span>, <span class="st">"total_ups"</span>, <span class="st">"score"</span>, <span class="st">"num_comments"</span>, <span class="st">"subreddit_subscribers"</span>, <span class="st">"upvote_ratio"</span>), <span class="at">names_to =</span> <span class="st">"Variable"</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>)</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a grouped bar plot</span></span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cluster_data_long, <span class="fu">aes</span>(<span class="at">x =</span> Variable, <span class="at">y =</span> Value, <span class="at">fill =</span> .cluster)) <span class="sc">+</span></span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cluster Comparison"</span>, <span class="at">x =</span> <span class="st">"Variables"</span>, <span class="at">y =</span> <span class="st">"Values"</span>) <span class="sc">+</span></span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb202-13"><a href="#cb202-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),  <span class="co"># Rotate x-axis labels</span></span>
<span id="cb202-14"><a href="#cb202-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span>                       <span class="co"># Move legend to the bottom</span></span>
<span id="cb202-15"><a href="#cb202-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_palette)                <span class="co"># Use custom color palette for clusters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="23007---DS202W-Sum-3-ALL_files/figure-html/unnamed-chunk-178-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join cluster_assignments with post_comments_data to get corresponding post_id</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>post_ids_by_cluster_with_comments <span class="ot">&lt;-</span> cluster_assignments <span class="sc">%&gt;%</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(post_comment_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"post_id"</span> <span class="ot">=</span> <span class="st">"post_id"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(post_id, subreddit, .cluster) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the result</span></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(post_ids_by_cluster_with_comments)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 997 × 3
   post_id subreddit       .cluster
   &lt;chr&gt;   &lt;chr&gt;           &lt;fct&gt;   
 1 11t0pyf r/OldSchoolCool 4       
 2 11t7o0j r/funny         2       
 3 11t9u95 r/aww           2       
 4 11tgzva r/funny         4       
 5 11tkmir r/aww           2       
 6 11tnzea r/gaming        2       
 7 11toxgx r/pics          4       
 8 11tqcaf r/UpliftingNews 5       
 9 11ttyna r/worldnews     5       
10 11u08ib r/movies        4       
# ℹ 987 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter the dataframe to include only rows corresponding to clusters 1 to 5</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>subreddits_clusters_1_to_5 <span class="ot">&lt;-</span> post_ids_by_cluster_with_comments <span class="sc">%&gt;%</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.cluster <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.cluster, subreddit)</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table where each row represents a subreddit and each cell contains the list of clusters where the subreddit appears</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>subreddits_table <span class="ot">&lt;-</span> subreddits_clusters_1_to_5 <span class="sc">%&gt;%</span></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subreddit =</span> <span class="fu">as.character</span>(subreddit)) <span class="sc">%&gt;%</span>  <span class="co"># Ensure subreddit column is character type</span></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subreddit) <span class="sc">%&gt;%</span></span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">clusters =</span> <span class="fu">toString</span>(<span class="fu">unique</span>(.cluster))) <span class="sc">%&gt;%</span></span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> subreddit, <span class="at">value =</span> clusters, <span class="at">fill =</span> <span class="st">""</span>)</span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the transposed table</span></span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">t</span>(subreddits_table))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    [,1]        
r/AskReddit         "1, 3, 5"   
r/aww               "2, 5, 1, 4"
r/books             "5"         
r/dataisbeautiful   "2"         
r/DIY               "5"         
r/EarthPorn         "2, 5"      
r/food              "5"         
r/funny             "2, 4, 5, 1"
r/gadgets           "5"         
r/gaming            "2, 4, 1, 5"
r/gifs              "2, 1, 4, 5"
r/LifeProTips       "4, 2, 5"   
r/mildlyinteresting "4, 1, 2, 5"
r/movies            "4, 5, 2"   
r/Music             "2"         
r/news              "5, 4, 2, 1"
r/nottheonion       "2, 4, 5"   
r/OldSchoolCool     "4, 2, 5"   
r/pics              "4, 5, 1, 2"
r/science           "5, 2"      
r/Showerthoughts    "5, 1, 4, 2"
r/space             "2, 5, 1"   
r/sports            "2"         
r/tifu              "5, 4"      
r/todayilearned     "5, 2, 4"   
r/UpliftingNews     "5, 2"      
r/videos            "2, 5, 4"   
r/worldnews         "5, 2, 4, 1"</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>
